openapi: 3.0.3

info:
  title: Vaping Stamps API
  version: "1.0"
  description: |
    # Overview
    Use this API to verify purchasing operators’ approval to buy vaping duty stamps.

    This API exposes a single endpoint that allows the appointed stamp supplier
    to perform a daily approval status check against HMRC systems.

    Weekly CSV data submissions are handled separately via SDES using pre-signed URLs
    and are documented in the Service Guide. They are not implemented as API endpoints.

servers:
  - url: https://api.service.hmrc.gov.uk

tags:
  - name: Approval status
    description: Endpoints for checking operator approval to purchase vaping duty stamps

paths:
  /misc/vaping/stamps:
    get:
      tags:
        - Approval status
      summary: Check purchasing operator approval status
      description: |
        Checks whether a purchasing operator is approved to buy vaping duty stamps.
      operationId: checkApprovalStatus

      security:
        - applicationRestricted: []

      parameters:
        - name: vdsApprovalId
          in: query
          required: true
          description: |
            Vaping Duty Stamps Approval ID issued by HMRC.
            Format: 4 letters, 7 numbers, 2 letters.
            Example: ABCD1234567EF
          schema:
            type: string
            pattern: "^[A-Z]{4}[0-9]{7}[A-Z]{2}$"

        - name: businessName
          in: query
          required: true
          description: Registered business name of the purchasing operator
          schema:
            type: string

      responses:
        "200":
          description: Operator record found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApprovedOperatorResponse"

        "204":
          description: Request processed successfully but no content is returned

        "400":
          description: |
            Client error — the request is malformed or fails validation.
          content:
            application/json:
              schema:
                type: object
                required: [code, message]
                properties:
                  code:
                    type: string
                    example: INVALID_REQUEST
                  message:
                    type: string
                    example: The request payload is invalid or malformed.

        "401":
          description: |
            Client error — authentication credentials are missing or invalid.
          content:
            application/json:
              schema:
                type: object
                required: [code, message]
                properties:
                  code:
                    type: string
                    example: UNAUTHORISED
                  message:
                    type: string
                    example: Authentication credentials are missing or invalid.

        "403":
          description: |
            Client error — the client is authenticated but not authorised to perform this action.
          content:
            application/json:
              schema:
                type: object
                required: [code, message]
                properties:
                  code:
                    type: string
                    example: FORBIDDEN
                  message:
                    type: string
                    example: You are not authorised to access this resource.

        "404":
          description: |
            Client error — no approval record exists for the supplied identifiers.
          content:
            application/json:
              schema:
                type: object
                required: [code, message]
                properties:
                  code:
                    type: string
                    example: NOT_FOUND
                  message:
                    type: string
                    example: The requested approval could not be found.

        "409":
          description: |
            Client error — the request conflicts with the current state of the resource.
          content:
            application/json:
              schema:
                type: object
                required: [code, message]
                properties:
                  code:
                    type: string
                    example: CONFLICT
                  message:
                    type: string
                    example: The request conflicts with the current state of the resource.

        "500":
          description: |
            Server error — an unexpected internal error occurred while processing the request.
          content:
            application/json:
              schema:
                type: object
                required: [code, message]
                properties:
                  code:
                    type: string
                    example: INTERNAL_SERVER_ERROR
                  message:
                    type: string
                    example: An unexpected error occurred while processing the request.

        "503":
          description: |
            Server error — the service is temporarily unavailable.
            Clients may retry the request later.
          content:
            application/json:
              schema:
                type: object
                required: [code, message]
                properties:
                  code:
                    type: string
                    example: SERVICE_UNAVAILABLE
                  message:
                    type: string
                    example: The service is temporarily unavailable. Please try again later.

components:
  securitySchemes:
    applicationRestricted:
      type: oauth2
      description: |
        HMRC supports OAuth 2.0 for authenticating application restricted API requests
        using an OAuth 2.0 Bearer Token in the AUTHORIZATION header.

        See https://developer.service.hmrc.gov.uk/api-documentation/docs/authorisation/application-restricted-endpoints
        for details.
      flows:
        clientCredentials:
          tokenUrl: https://api.service.hmrc.gov.uk/oauth/token
          scopes: {}

  schemas:
    ApprovedOperatorResponse:
      type: object
      required:
        - approvalStatus
        - businessName
        - registeredBusinessAddress
        - contactName
        - contactTelephone
        - contactEmail
        - approvalNumber
        - stampThreshold
      properties:
        approvalStatus:
          type: string
          example: APPROVED

        businessName:
          type: string
          example: Example Trading Ltd

        registeredBusinessAddress:
          type: string
          example: 10 Example Street, London, SW1A 1AA

        correspondenceAddress:
          type: string
          example: PO Box 123, London, SW1A 2AB

        contactName:
          type: string
          example: Jane Smith

        contactTelephone:
          type: string
          example: "+44 20 7946 0123"

        contactEmail:
          type: string
          format: email
          example: jane.smith@example.com

        approvalNumber:
          type: string
          example: ABCD1234567EF

        stampThreshold:
          type: number
          description: Approved stamp purchase threshold
          example: 500000